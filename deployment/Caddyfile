# =============================================================================
# Drofbot Caddyfile — Reverse Proxy + Static Files
# =============================================================================
# Domain: drofy.net

{
    email admin@drofy.net
}

drofy.net {
    # Serve dashboard static files
    root * /opt/drofbot/src/dashboard/dist
    file_server

    # Proxy API requests to the Drofbot gateway process
    handle /api/* {
        reverse_proxy localhost:18789
    }

    # WebSocket upgrade for control/gateway connections
    handle /ws/* {
        reverse_proxy localhost:18789
    }

    # OpenClaw Control UI (Gateway Internal)
    handle /__openclaw__/* {
        reverse_proxy localhost:18789
    }

    # OpenClaw Control UI (Direct Access fallback if main dashboard captures /)
    handle /control/* {
        reverse_proxy localhost:18789
    }

    # SPA fallback — serve index.html for all non-file routes
    handle {
        try_files {path} /index.html
        file_server
    }

    # Logging
    log {
        output file /var/log/caddy/access.log {
            roll_size 10mb
            roll_keep 5
        }
    }
}

# Optional: Direct gateway access (for debugging or internal use)
:8080 {
    reverse_proxy localhost:18789
}
